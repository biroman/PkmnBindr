# PDF Export Feature

This document describes the new PDF export feature that allows users to generate printable PDF files of their Pokémon Trading Card binders.

## Overview

The PDF export feature enables users to:

- Generate a complete PDF document containing all pages of their binder
- Include a custom cover page with binder information
- Export all card pages with proper card layout and information
- Download the PDF for printing or sharing

## Features

### 🎯 Core Functionality

- **One-click PDF generation** - Simple button click to generate PDF
- **Complete binder export** - Includes cover page and all card pages
- **High-quality output** - Cards are rendered at high resolution for print quality
- **Automatic pagination** - Properly organizes cards into pages based on grid layout
- **Print-optimized layout** - Designed specifically for physical printing

### 📄 PDF Content

- **Cover Page**:
  - Binder name and description
  - Total card count and grid layout information
  - Creation date and branding
- **Card Pages**:
  - All cards organized by current grid layout (3x3, 4x4, 5x5, 6x6)
  - Card images with names displayed
  - Empty slots numbered for easy reference
  - Page numbers and binder holes for authentic look

### 🔒 Subscription Integration

- **Respects subscription limits** - Different tiers have different export limits
- **Usage tracking** - Tracks PDF exports against user's monthly/daily limits
- **Permission checking** - Validates user has access to PDF export feature

## Technical Implementation

### Dependencies

- `jspdf` - PDF generation library
- `html2canvas` - HTML to canvas conversion for rendering components

### Core Components

#### 1. PdfExportService (`src/services/PdfExportService.js`)

Main service responsible for:

- Creating PDF document structure
- Rendering cover page and card pages
- Converting HTML elements to PDF-compatible format
- Handling image loading and CORS issues
- Managing file download

#### 2. Export Tracking Hook (`src/hooks/useExportTracking.js`)

Custom hook for:

- Tracking export usage for both authenticated and anonymous users
- Respecting subscription tier limits
- Local storage for anonymous user tracking

#### 3. Rules Integration (`src/lib/binderRules.js`)

- Added `pdf_export` action mapping
- Rate limiting rules for PDF exports
- Permission checking integration

### Usage

#### In Components

```jsx
import pdfExportService from "../services/PdfExportService";
import useExportTracking from "../hooks/useExportTracking";
import { useRules } from "../contexts/RulesContext";

const MyComponent = () => {
  const { canPerformAction } = useRules();
  const { trackExport } = useExportTracking();

  const handlePdfExport = async () => {
    // Check permissions
    const canExport = await canPerformAction("pdf_export");
    if (!canExport.allowed) {
      console.error(canExport.reason);
      return;
    }

    try {
      // Generate PDF
      await pdfExportService.generateBinderPdf(binder, {
        quality: 0.95,
        format: "a4",
        includeEmptyPages: false,
      });

      // Track usage
      await trackExport("pdf");
    } catch (error) {
      console.error("PDF export failed:", error);
    }
  };
};
```

## User Interface

### Toolbar Integration

The PDF export feature is accessible via the binder toolbar:

- Located in the left sidebar toolbar
- Uses DocumentArrowDownIcon from Heroicons
- Shows tooltip "Export as PDF" on hover
- Integrates seamlessly with existing toolbar actions

## Subscription Limits

### Default Limits by Tier

- **Free Tier**: 10 PDF exports per day
- **Supporter Tier**: 25 PDF exports per day
- **Collector Tier**: 50 PDF exports per day
- **Enthusiast Tier**: 100 PDF exports per day

### Error Handling

- Clear error messages when limits are exceeded
- Guidance to upgrade subscription tier
- Graceful fallback for network issues

## PDF Structure

### Page 1: Cover Page

```
┌─────────────────────────────────┐
│        BINDER NAME              │
│        Description              │
│                                 │
│    ┌─────────┐  ┌─────────┐    │
│    │   150   │  │   3×3   │    │
│    │  Cards  │  │  Grid   │    │
│    └─────────┘  └─────────┘    │
│                                 │
│    Created: MM/DD/YYYY          │
│    Generated by PokémonBindr    │
└─────────────────────────────────┘
```

### Page 2+: Card Pages

```
┌─────────────────────────────────┐
│ Page 1                    ○ ○ ○ │
├─────────────────────────────────┤
│ ┌───┐ ┌───┐ ┌───┐              │
│ │[1]│ │[2]│ │[3]│              │
│ └───┘ └───┘ └───┘              │
│ ┌───┐ ┌───┐ ┌───┐              │
│ │[4]│ │[5]│ │[6]│              │
│ └───┘ └───┘ └───┘              │
│ ┌───┐ ┌───┐ ┌───┐              │
│ │[7]│ │[8]│ │[9]│              │
│ └───┘ └───┘ └───┘              │
└─────────────────────────────────┘
```

## Error Handling

### Common Issues & Solutions

#### 1. CORS Issues with Card Images

- **Problem**: External images fail to load in PDF
- **Solution**: Service includes fallback placeholder for failed images

#### 2. Large Binder Performance

- **Problem**: Large binders may take time to process
- **Solution**: Loading indicators and progressive generation

#### 3. Empty Binders

- **Problem**: Binders with no cards
- **Solution**: Still generates cover page, can optionally include empty pages

#### 4. Network Failures

- **Problem**: Image loading failures
- **Solution**: Graceful degradation with card name placeholders

## Configuration Options

### PDF Generation Options

```javascript
const options = {
  quality: 0.95, // Image quality (0.1 - 1.0)
  format: "a4", // Paper format (a4, letter, etc.)
  includeEmptyPages: false, // Include completely empty pages
  filename: "custom.pdf", // Custom filename (optional)
};
```

### Performance Considerations

- Uses `imageSmall` when available for better performance
- Scales images appropriately for print resolution
- Efficient memory management for large binders

## Future Enhancements

### Planned Features

- [ ] **Custom page layouts** - Different arrangements beyond grid
- [ ] **Batch export** - Export multiple binders at once
- [ ] **Print settings** - Page margins, orientation options
- [ ] **Watermarking** - Optional branding/user watermarks
- [ ] **Progress indicators** - Show export progress for large binders

### Potential Improvements

- [ ] **Advanced image handling** - Better CORS proxy support
- [ ] **Template system** - Multiple cover page designs
- [ ] **Compression options** - File size vs quality tradeoffs
- [ ] **Print preview** - Show PDF preview before download

## Testing

### Manual Testing Checklist

- [ ] Export empty binder (cover page only)
- [ ] Export small binder (1-2 pages)
- [ ] Export large binder (10+ pages)
- [ ] Test with missing card images
- [ ] Test different grid sizes (3x3, 4x4, 5x5, 6x6)
- [ ] Test subscription limit enforcement
- [ ] Test error handling for network issues

### Browser Compatibility

- ✅ Chrome/Chromium browsers
- ✅ Firefox
- ✅ Safari
- ✅ Edge
- ⚠️ IE11 (limited support)

## Troubleshooting

### Common User Issues

**Q: PDF download doesn't start**
A: Check browser popup blockers and download settings

**Q: PDF is blank or corrupted**  
A: Usually due to network issues loading card images. Try again with better connection.

**Q: "Export limit reached" error**
A: User has hit their subscription tier's daily/monthly limit. Upgrade subscription or wait for reset.

**Q: PDF takes too long to generate**
A: Large binders with many high-resolution images take time. Consider including fewer empty pages.

### Developer Debugging

- Check browser console for image loading errors
- Verify binder data structure is complete
- Test with different network conditions
- Monitor memory usage for large exports

---

_This feature enhances the PokémonBindr experience by providing users with a professional way to print and share their collections._
